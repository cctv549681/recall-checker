# äº‘æœåŠ¡å™¨éƒ¨ç½²æ–‡æ¡£

> **æœåŠ¡å™¨ä¿¡æ¯**: Ubuntu 24.04 @ 14.103.26.111
> **æ›´æ–°æ—¶é—´**: 2026-01-31 17:20
> **çŠ¶æ€**: éƒ¨ç½²è„šæœ¬å·²å°±ç»ª

---

## ğŸ“Š éƒ¨ç½²æ¸…å•

### âœ… å·²å®Œæˆ

| ä»»åŠ¡ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| æ•°æ®æ¸…ç† | âœ… å®Œæˆ | åˆ é™¤3084æ¡é›…åŸ¹è¿‡æœŸæ•°æ®ï¼Œä¿ç•™38æ¡é›€å·¢æ•°æ® |
| éƒ¨ç½²è„šæœ¬ | âœ… å®Œæˆ | 4ä¸ªéƒ¨ç½²è„šæœ¬å·²åˆ›å»º |
| APIæœåŠ¡å™¨ | âœ… å®Œæˆ | Flask API æœ¬åœ°è¿è¡Œæ­£å¸¸ |

### â¸ï¸ å¾…å®Œæˆ

| ä»»åŠ¡ | ä¼˜å…ˆçº§ | è¯´æ˜ |
|------|--------|------|
| ä¸Šä¼ ä»£ç åˆ°æœåŠ¡å™¨ | ğŸ”´ é«˜ | ä¸Šä¼ é¡¹ç›®ä»£ç åˆ°äº‘æœåŠ¡å™¨ |
| é…ç½®ç¯å¢ƒå˜é‡ | ğŸ”´ é«˜ | é…ç½®é£ä¹¦ API å‡­è¯ |
| å®‰è£… Python ä¾èµ– | ğŸ”´ é«˜ | å®‰è£… Flaskã€requests ç­‰ |
| é…ç½® Nginx åå‘ä»£ç† | ğŸ”´ é«˜ | é…ç½® Nginx åå‘ä»£ç†åˆ° Flask API |
| å¯åŠ¨ API æœåŠ¡ | ğŸ”´ é«˜ | å¯åŠ¨ Flask API æœåŠ¡ |
| æµ‹è¯• API è¿æ¥ | ğŸŸ¡ ä¸­ | æµ‹è¯•äº‘æœåŠ¡å™¨çš„ API æ˜¯å¦å¯ç”¨ |
| ä¿®æ”¹å°ç¨‹åº API åœ°å€ | ğŸŸ¡ ä¸­ | ä¿®æ”¹å°ç¨‹åºæŒ‡å‘äº‘æœåŠ¡å™¨ |
| æäº¤å°ç¨‹åºå®¡æ ¸ | ğŸŸ¢ ä½ | æäº¤å°ç¨‹åºå®¡æ ¸ |

---

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### ç¬¬1æ­¥ï¼šä¸Šä¼ ä»£ç ï¼ˆæœ¬åœ°æ‰§è¡Œï¼‰

```bash
cd /root/clawd/recall-checker/deploy
bash upload_code.sh
```

**æ‰§è¡Œå†…å®¹**ï¼š
1. æ‰“åŒ…é¡¹ç›®ä»£ç 
2. ä¸Šä¼ åˆ°æœåŠ¡å™¨ `/tmp/` ç›®å½•
3. åœ¨æœåŠ¡å™¨è§£å‹åˆ° `/root/recall-checker`
4. å®‰è£… Python ä¾èµ–
5. åˆ›å»º `.env` æ¨¡æ¿æ–‡ä»¶

**é¢„æœŸè¾“å‡º**ï¼š
```
âœ… é¡¹ç›®æ‰“åŒ…å®Œæˆ
âœ… ä»£ç ä¸Šä¼ å®Œæˆ
âœ… ä»£ç è§£å‹å®Œæˆ
âœ… ä¾èµ–å®‰è£…å®Œæˆ
```

---

### ç¬¬2æ­¥ï¼šé…ç½®ç¯å¢ƒå˜é‡ï¼ˆæœåŠ¡å™¨æ‰§è¡Œï¼‰

```bash
ssh root@14.103.26.111
cd /root/recall-checker/scraper
nano .env
```

**éœ€è¦é…ç½®çš„å˜é‡**ï¼š

```bash
# é£ä¹¦ API é…ç½®
APP_ID=your_app_id_here
APP_SECRET=your_app_secret_here
APP_TOKEN=your_app_token_here
TABLE_ID=your_table_id_here

# Flask é…ç½®
FLASK_APP=api_server.py
FLASK_ENV=production
FLASK_DEBUG=False

# æœåŠ¡å™¨é…ç½®
HOST=0.0.0.0
PORT=5001

# æ•°æ®ç¼“å­˜é…ç½®
CACHE_TTL=300
```

**æ³¨æ„äº‹é¡¹**ï¼š
- ä»æœ¬åœ° `/root/clawd/recall-checker/scraper/utils/feishu_config.py` å¤åˆ¶é£ä¹¦å‡­è¯
- ç¡®ä¿ `APP_ID`ã€`APP_SECRET`ã€`APP_TOKEN`ã€`TABLE_ID` é…ç½®æ­£ç¡®

---

### ç¬¬3æ­¥ï¼šé…ç½® Nginx åå‘ä»£ç†ï¼ˆæœåŠ¡å™¨æ‰§è¡Œï¼‰

```bash
ssh root@14.103.26.111
bash /root/recall-checker/deploy/setup_server.sh
```

**æ‰§è¡Œå†…å®¹**ï¼š
1. å®‰è£… nginx
2. é…ç½®åå‘ä»£ç†
3. é…ç½®é˜²ç«å¢™
4. å¯ç”¨ nginx æœåŠ¡

**Nginx é…ç½®**ï¼š
```nginx
server {
    listen 80;
    server_name 14.103.26.111;

    location / {
        proxy_pass http://127.0.0.1:5001;
        proxy_set_header Host $host;
    }

    location /health {
        proxy_pass http://127.0.0.1:5001/api/health;
    }

    location /api {
        proxy_pass http://127.0.0.1:5001;
    }
}
```

---

### ç¬¬4æ­¥ï¼šå¯åŠ¨ API æœåŠ¡ï¼ˆæœåŠ¡å™¨æ‰§è¡Œï¼‰

**æ–¹å¼1ï¼šä½¿ç”¨å¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰**
```bash
ssh root@14.103.26.111
cd /root/recall-checker
bash start.sh
```

**æ–¹å¼2ï¼šæ‰‹åŠ¨å¯åŠ¨**
```bash
ssh root@14.103.26.111
cd /root/recall-checker/scraper
source venv/bin/activate
python3 api_server.py
```

**å¯åŠ¨è¾“å‡º**ï¼š
```
å¯åŠ¨å¬å›æŸ¥è¯¢APIæœåŠ¡å™¨ï¼Œç«¯å£: 5001
é£ä¹¦è¡¨æ ¼: tblA1YqzSi4aaxeI
é¢„çƒ­ç¼“å­˜...
æˆåŠŸè·å–é£ä¹¦token
æˆåŠŸè·å– 38 æ¡å¬å›è®°å½•
æ›´æ–°ç¼“å­˜: 38 æ¡è®°å½•
* Running on http://0.0.0.0:5001
```

---

### ç¬¬5æ­¥ï¼šæµ‹è¯• API è¿æ¥ï¼ˆæœ¬åœ°æ‰§è¡Œï¼‰

```bash
# æµ‹è¯•å¥åº·æ£€æŸ¥
curl http://14.103.26.111/api/health

# æµ‹è¯•æŸ¥è¯¢æ¥å£
curl -X POST http://14.103.26.111/api/query \
  -H "Content-Type: application/json" \
  -d '{"batch_code":"51450742F1"}'

# æµ‹è¯•ç»Ÿè®¡æ¥å£
curl http://14.103.26.111/api/stats
```

**é¢„æœŸè¾“å‡º**ï¼š
```json
// å¥åº·æ£€æŸ¥
{
  "service": "recall-checker-api",
  "status": "ok",
  "timestamp": "2026-01-31T09:20:00.000Z"
}

// æŸ¥è¯¢æ¥å£
{
  "success": true,
  "status": "recalled",
  "message": "æ‰¾åˆ° 5 æ¡å¬å›è®°å½•",
  "data": [...]
}
```

---

### ç¬¬6æ­¥ï¼šä¿®æ”¹å°ç¨‹åº API åœ°å€

ç¼–è¾‘ `/root/clawd/recall-checker/miniprogram/utils/api_client.js`:

```javascript
constructor() {
  // ä¿®æ”¹ä¸ºäº‘æœåŠ¡å™¨åœ°å€
  this.localApiUrl = 'http://14.103.26.111/api';
  
  this.apiType = 'local'; // 'local' æˆ– 'feishu'
}
```

---

## ğŸ“‹ éƒ¨ç½²è„šæœ¬è¯´æ˜

### 1. deploy_server.sh - æœåŠ¡å™¨åˆå§‹åŒ–

**åŠŸèƒ½**ï¼š
- æ›´æ–°ç³»ç»Ÿ
- å®‰è£… Python 3
- é…ç½® Nginx
- é…ç½®é˜²ç«å¢™

**ä½¿ç”¨æ–¹æ³•**ï¼š
```bash
bash deploy_server.sh
```

---

### 2. upload_code.sh - ä»£ç ä¸Šä¼ 

**åŠŸèƒ½**ï¼š
- æ‰“åŒ…é¡¹ç›®ä»£ç 
- ä¸Šä¼ åˆ°æœåŠ¡å™¨
- è§£å‹ä»£ç 
- å®‰è£…ä¾èµ–
- åˆ›å»ºç¯å¢ƒå˜é‡æ¨¡æ¿

**ä½¿ç”¨æ–¹æ³•**ï¼š
```bash
bash upload_code.sh
```

---

### 3. setup_env.sh - ç¯å¢ƒé…ç½®

**åŠŸèƒ½**ï¼š
- åˆ›å»ºé¡¹ç›®ç›®å½•
- åˆ›å»º Python è™šæ‹Ÿç¯å¢ƒ
- åˆ›å»ºç¯å¢ƒå˜é‡æ–‡ä»¶
- è®¾ç½®æƒé™
- åˆ›å»ºå¯åŠ¨è„šæœ¬

**ä½¿ç”¨æ–¹æ³•**ï¼š
```bash
bash setup_env.sh
```

---

### 4. start_api.sh - API æœåŠ¡å¯åŠ¨

**åŠŸèƒ½**ï¼š
- æ£€æŸ¥ Python ç¯å¢ƒ
- æ£€æŸ¥é¡¹ç›®ç›®å½•
- å®‰è£…ä¾èµ–
- åˆ›å»ºæ—¥å¿—ç›®å½•
- å¯åŠ¨ API æœåŠ¡

**ä½¿ç”¨æ–¹æ³•**ï¼š
```bash
bash start_api.sh
```

---

## ğŸ”§ å¸¸ç”¨å‘½ä»¤

### æœåŠ¡å™¨ç®¡ç†

```bash
# SSH ç™»å½•
ssh root@14.103.26.111

# æŸ¥çœ‹è¿›ç¨‹
ps aux | grep api_server

# æŸ¥çœ‹æ—¥å¿—
tail -f /root/recall-checker/logs/api_server.log

# åœæ­¢ API æœåŠ¡
kill $(cat /root/recall-checker/api_server.pid)

# é‡å¯ API æœåŠ¡
bash /root/recall-checker/start.sh

# æŸ¥çœ‹ç£ç›˜ä½¿ç”¨
df -h

# æŸ¥çœ‹å†…å­˜ä½¿ç”¨
free -m
```

### API æµ‹è¯•

```bash
# å¥åº·æ£€æŸ¥
curl http://14.103.26.111/api/health

# æ‰¹æ¬¡å·æŸ¥è¯¢
curl -X POST http://14.103.26.111/api/query \
  -H "Content-Type: application/json" \
  -d '{"batch_code":"51450742F1"}'

# æ•°æ®ç»Ÿè®¡
curl http://14.103.26.111/api/stats
```

---

## ğŸ” æ•…éšœæ’æŸ¥

### é—®é¢˜1ï¼šæ— æ³• SSH ç™»å½•

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥æœåŠ¡å™¨ IP æ˜¯å¦æ­£ç¡®ï¼š`ping 14.103.26.111`
2. æ£€æŸ¥ SSH æœåŠ¡æ˜¯å¦è¿è¡Œï¼š`telnet 14.103.26.111 22`
3. æ£€æŸ¥é˜²ç«å¢™è®¾ç½®

### é—®é¢˜2ï¼šAPI æœåŠ¡æ— æ³•å¯åŠ¨

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨ï¼š`lsof -i :5001`
2. æ£€æŸ¥ Python ç‰ˆæœ¬ï¼š`python3 --version`
3. æŸ¥çœ‹é”™è¯¯æ—¥å¿—ï¼š`cat /root/recall-checker/logs/api_server.log`

### é—®é¢˜3ï¼šNginx æ— æ³•è¿æ¥åˆ° Flask API

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥ Flask API æ˜¯å¦è¿è¡Œï¼š`ps aux | grep api_server`
2. æ£€æŸ¥ Nginx é…ç½®ï¼š`cat /etc/nginx/sites-enabled/recall-checker`
3. é‡å¯ Nginxï¼š`systemctl restart nginx`

### é—®é¢˜4ï¼šå°ç¨‹åºæ— æ³•è¿æ¥åˆ°äº‘ API

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥äº‘ API æ˜¯å¦å¯è®¿é—®ï¼š`curl http://14.103.26.111/api/health`
2. æ£€æŸ¥å°ç¨‹åºä¸­çš„ API åœ°å€é…ç½®
3. æ£€æŸ¥ç½‘ç»œè¿æ¥ï¼ˆæ˜¯å¦éœ€è¦åŸŸåå¤‡æ¡ˆï¼‰

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. å¯ç”¨ Gzip å‹ç¼©

```nginx
# Nginx é…ç½®
gzip on;
gzip_types text/plain text/css application/json application/javascript;
```

### 2. æ·»åŠ  HTTP ç¼“å­˜

```nginx
# Nginx é…ç½®
location /health {
    proxy_pass http://127.0.0.1:5001/api/health;
    proxy_cache_valid 200 1m;
}
```

### 3. ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢

- ä½¿ç”¨ç´¢å¼•
- é™åˆ¶è¿”å›å­—æ®µ
- å®ç°åˆ†é¡µæŸ¥è¯¢

### 4. ä½¿ç”¨ Redis ç¼“å­˜

```python
# Redis ç¼“å­˜ç¤ºä¾‹
import redis

redis_client = redis.Redis(host='localhost', port=6379, db=0)
redis_client.set('cache_key', json_data, ex=300)
```

---

## ğŸ¯ ä¸Šçº¿æ£€æŸ¥æ¸…å•

### æœåŠ¡å™¨é…ç½®

- [x] æœåŠ¡å™¨å·²è´­ä¹°
- [ ] ä»£ç å·²ä¸Šä¼ 
- [ ] ç¯å¢ƒå˜é‡å·²é…ç½®
- [ ] Python ä¾èµ–å·²å®‰è£…
- [ ] Nginx å·²é…ç½®
- [ ] API æœåŠ¡å·²å¯åŠ¨
- [ ] API æœåŠ¡å·²æµ‹è¯•

### åŠŸèƒ½æµ‹è¯•

- [ ] å¥åº·æ£€æŸ¥æ¥å£æ­£å¸¸
- [ ] æ‰¹æ¬¡å·æŸ¥è¯¢æ¥å£æ­£å¸¸
- [ ] æ•°æ®ç»Ÿè®¡æ¥å£æ­£å¸¸
- [ ] é”™è¯¯å¤„ç†æ­£å¸¸
- [ ] æ—¥å¿—è®°å½•æ­£å¸¸

### å°ç¨‹åºé…ç½®

- [ ] API åœ°å€å·²ä¿®æ”¹ä¸ºäº‘æœåŠ¡å™¨
- [ ] API è¿æ¥å·²æµ‹è¯•
- [ ] OCR åŠŸèƒ½å·²é…ç½®ï¼ˆå¦‚æœä½¿ç”¨ï¼‰
- [ ] åŠŸèƒ½æµ‹è¯•é€šè¿‡

### å®¡æ ¸å‡†å¤‡

- [ ] å°ç¨‹åºåç§°å·²è®¾ç½®
- [ ] å°ç¨‹åºå›¾æ ‡å·²ä¸Šä¼ 
- [ ] å°ç¨‹åºæˆªå›¾å·²ä¸Šä¼ 
- [ ] æœåŠ¡ç±»ç›®å·²é€‰æ‹©
- [ ] éšç§æ”¿ç­–å·²æ·»åŠ 
- [ ] ç”¨æˆ·åè®®å·²æ·»åŠ 
- [ ] èµ„è´¨æ–‡ä»¶å·²å‡†å¤‡

---

## ğŸ“ æ”¯æŒä¿¡æ¯

### æœåŠ¡å™¨ä¿¡æ¯

- **ç³»ç»Ÿ**: Ubuntu 24.04
- **IP åœ°å€**: 14.103.26.111
- **SSH ç”¨æˆ·**: root
- **é¡¹ç›®ç›®å½•**: /root/recall-checker
- **API ç«¯å£**: 5001

### API æ¥å£

- **å¥åº·æ£€æŸ¥**: http://14.103.26.111/api/health
- **æ‰¹æ¬¡å·æŸ¥è¯¢**: POST http://14.103.26.111/api/query
- **æ•°æ®ç»Ÿè®¡**: GET http://14.103.26.111/api/stats

### è„šæœ¬ç›®å½•

- **éƒ¨ç½²è„šæœ¬**: /root/recall-checker/deploy
- **å¯åŠ¨è„šæœ¬**: /root/recall-checker/start.sh
- **æ—¥å¿—ç›®å½•**: /root/recall-checker/logs
- **æ•°æ®ç›®å½•**: /root/recall-checker/data

---

**åˆ›å»ºæ—¶é—´**: 2026-01-31 17:20
**ç‰ˆæœ¬**: v2.0.1
**çŠ¶æ€**: ğŸš€ éƒ¨ç½²è„šæœ¬å·²å°±ç»ªï¼Œå¯ä»¥å¼€å§‹éƒ¨ç½²
