<!--index.wxml - 首页（更新版，添加手动输入功能）-->
<view class="container">
  <!-- 顶部 -->
  <view class="top-bar">
    <image class="logo-icon" src="/assets/nestle-logo.png" mode="aspectFit"></image>
    <text class="text-title">产品召回查询</text>
  </view>

  <!-- 主操作区 -->
  <view class="card mt-32">
    <!-- OCR 扫描按钮 -->
    <view class="flex-column flex-center" bindtap="goToCamera">
      <view class="icon-large bg-primary mb-16">
        <text class="icon-large">📸</text>
      </view>
      <text class="text-title mb-8">拍照识别批次号</text>
      <text class="text-small text-muted">支持自动识别批次号</text>
    </view>

    <!-- 手动输入 -->
    <view class="input-section">
      <view class="input-label">或手动输入批次号</view>
      <view class="input-wrapper">
        <input 
          class="input" 
          placeholder="请输入批次号，如：51450742F1"
          bindinput="onManualInput"
          value="{{manualBatchInput}}"
          focus="{{inputFocused}}"
          bindfocus="onInputFocus"
          bindblur="onInputBlur"
          confirm-type="done"
        />
        <view class="clear-btn" wx:if="{{manualBatchInput}}" bindtap="clearInput">
          <text>✕</text>
        </view>
      </view>
      <view class="input-actions">
        <button class="btn-primary btn-full" bindtap="confirmInput">
          <text class="btn-text">查询</text>
        </button>
      </view>
    </view>
  </view>

  <!-- 底部：历史记录 -->
  <view class="mt-32">
    <view class="flex-between mb-16">
      <text class="text-title">📋 最近查询</text>
      <text class="text-small text-primary" bindtap="goToHistory">查看全部 ></text>
    </view>

    <!-- 历史记录列表 -->
    <block wx:for="{{item in recentHistory}}">
      <view class="history-card mb-16" bindtap="goToHistoryDetail" data-batch="{{item.batchCode}}">
        <view class="flex-between">
          <view class="flex">
            <text class="text-subtitle">{{item.batchCode}}</text>
            <view class="status-badge {{item.statusClass}}">{{item.statusText}}</view>
          </view>
          <text class="text-small text-muted">{{item.timeAgo}}</text>
        </view>
        <view class="mt-8">
          <text class="text-small">{{item.productName}}</text>
        </view>
      </view>
    </block>

    <!-- 空状态 -->
    <view wx:if="{{recentHistory.length === 0}}" class="flex-column flex-center pt-64 pb-64">
      <view class="icon-large mb-32">📭</view>
      <text class="text-title mb-16">暂无查询记录</text>
      <view class="btn-secondary mt-24" bindtap="goToCamera">
        <text class="text-title">去查询</text>
      </view>
    </view>
  </view>
</view>
