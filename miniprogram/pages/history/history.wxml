<!--history.wxml - 历史记录页面（重构版）-->
<view class="page-container">
  <!-- 顶部导航栏 -->
  <view class="navbar">
    <view class="back-btn" bindtap="goBack">
      <text class="back-icon">←</text>
    </view>
    <text class="navbar-title">查询历史</text>
    <view class="clear-btn" bindtap="showClearModal">
      <text class="clear-icon">🗑️</text>
    </view>
  </view>

  <!-- 筛选标签栏 -->
  <view class="filter-tabs">
    <view
      class="tab-item {{filter === 'all' ? 'active' : ''}}"
      bindtap="setFilter"
      data-filter="all"
    >
      <text>全部</text>
    </view>
    <view
      class="tab-item {{filter === 'recalled' ? 'active' : ''}}"
      bindtap="setFilter"
      data-filter="recalled"
    >
      <text>召回中</text>
    </view>
    <view
      class="tab-item {{filter === 'not_recalled' ? 'active' : ''}}"
      bindtap="setFilter"
      data-filter="not_recalled"
    >
      <text>未召回</text>
    </view>
  </view>

  <!-- 统计信息 -->
  <view wx:if="{{historyList.length > 0}}" class="stats-bar">
    <text class="stats-text">共 {{historyList.length}} 条记录</text>
  </view>

  <!-- 历史记录列表 -->
  <scroll-view wx:if="{{historyList.length > 0}}" class="history-scroll" scroll-y>
    <view class="history-list">
      <view
        class="history-item"
        wx:for="{{historyList}}"
        wx:key="index"
        bindtap="goToResult"
        data-batch="{{item.batchCode}}"
      >
        <!-- 左侧：批次号和状态 -->
        <view class="item-left">
          <view class="batch-wrapper">
            <text class="batch-code">{{item.batchCode}}</text>
            <view class="status-badge status-{{item.statusClass}}">{{item.statusText}}</view>
          </view>
          <text class="time-text">{{item.timeAgo}}</text>
        </view>

        <!-- 右侧：产品信息 -->
        <view class="item-right">
          <text class="product-text">{{item.productName}}</text>
          <text class="arrow-icon">→</text>
        </view>
      </view>
    </view>
  </scroll-view>

  <!-- 空状态 -->
  <view wx:if="{{historyList.length === 0}}" class="empty-state">
    <view class="empty-icon">📭</view>
    <text class="empty-title">暂无查询记录</text>
    <text class="empty-desc">您的查询记录将保存在本地</text>
    <button class="empty-action-btn" bindtap="goToIndex">
      开始查询
    </button>
  </view>

  <!-- 清空确认弹窗 -->
  <view wx:if="{{showClearModal}}" class="modal-overlay">
    <view class="modal-mask" bindtap="hideClearModal"></view>
    <view class="modal-dialog" catchtap="">
      <view class="modal-content">
        <view class="modal-icon">🗑️</view>
        <text class="modal-title">确认清空</text>
        <text class="modal-desc">确定要清空所有查询记录吗？此操作不可撤销</text>

        <view class="modal-actions">
          <button class="modal-btn modal-btn-secondary" bindtap="hideClearModal">
            取消
          </button>
          <button class="modal-btn modal-btn-danger" bindtap="confirmClearReal">
            确认清空
          </button>
        </view>
      </view>
    </view>
  </view>
</view>
